@model IEnumerable<APIDAW.Models.DocumentStatus>
@{
	ViewBag.Title = "Home Page";
	//Layout = null;
}

<!DOCTYPE html>

<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ระบบจัดการอนุมัติเอกสารแบบพลวัต</title>
</head>

<body>
	<div class="col-md-12">
		<div class="panel panel-primary ">
			<div class="panel-heading ">จัดการสถานะเอกสาร</div>
			<div class="panel-body">
				<div>
					<a class="btn btn-primary" onclick="Get_Data_Add()" ><span class="glyphicon glyphicon-plus"></span> เพิ่มสถานะ</a>
				</div>
				<br><br>
				<div >

					<table class="table table-hover" style="word-break: break-all;">
						<thead>
							<tr>
								<th style="text-align:center">ลำดับ</th>
								<th style="text-align:center">ชื่อสถานะ (TH)</th>
								<th style="text-align:center">ชื่อสถานะ (EN)</th>
								<th style="text-align:center">ดำเนินการ</th>
							</tr>
						</thead>
						<tbody id="table_data">
							@{int i = 0; }
							@foreach (var item in Model)
							{
								i++;
							<tr style="text-align:center">
								
								<td>@i</td>
								<td>@Html.DisplayFor(modelItem => item.NameTH)</td>
								<td>@Html.DisplayFor(modelItem => item.NameEN)</td>
								<td>
									<a class="btn btn-warning" onclick="Get_Data_Edit('@item.Id','@item.NameTH','@item.NameEN')" ><span class="glyphicon glyphicon-pencil"></span> แก้ไข</a>
									<a class="btn btn-danger" onclick="Delete('@item.Id')" ><span class="glyphicon glyphicon-trash"></span> ลบสถานะ</a>
								</td>
							</tr>
							}
						</tbody>
					</table>

				</div>
			</div>
		</div>
	</div>

	@*start modal add*@
	<div class="modal fade" id="modal_add_document_status" role="dialog">
		@*start modal*@
		<div class="modal-dialog modal-lg">
			@*start modal dialog*@
			<div class="modal-content">
				@*start modal content*@
				<div class="modal-header">
					@*start modal header*@
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					<div class="modal-title" id="modal-title"><h2>เพิ่มสถานะเอกสาร</h2></div>
				</div>@*End modal header*@
				<div class="modal-body">
					@*start modal body*@
					<div class="col-md-12">
						@*start col*@
						<div class="col-md-4" style="text-align:right">
							<label>ชื่อสถานะเอกสาร(TH) :</label>
						</div>
						<div class="col-md-6">
							<input type="text" class="form-control"  id="AddTH"> </input>
						</div>
					</div> @*End col*@
					<br><br><br>
					<div class="col-md-12">
						@*start col*@
						<div class="col-md-4" style="text-align:right">
							<label>ชื่อสถานะเอกสาร(EN) :</label>
						</div>
						<div class="col-md-6">
							<input type="text" class="form-control"  id="AddEN"> </input>
						</div>
					</div> @*End col*@
					<br><br><br>
					<div class="col-md-12">
						@*start col*@
						<div style="text-align:right;">
							<button onclick="Add()" class="btn btn-success" >บันทึก</button> 
							<a class="btn btn-default" data-dismiss="modal">ยกเลิก</a>
						</div>
					</div>@*End col*@
					<br><br>
				</div>@*End modal body*@
			</div>@*End modal content*@
		</div>@*End modal dialog*@
	</div>@*End modal*@
	@*End modal add*@


@*start modal edit*@
<div class="modal fade" id="modal_edit_document_status" role="dialog">
	@*start modal*@
	<div class="modal-dialog modal-lg">
		@*start modal dialog*@
		<div class="modal-content">
			@*start modal content*@
			<div class="modal-header">
				@*start modal header*@
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<div class="modal-title" id="modal-title"><h2>แก้ไขสถานะเอกสาร</h2></div>
			</div>@*End modal header*@
			<div class="modal-body">
				@*start modal body*@
				<div class="col-md-12">
					@*start col*@
					<div class="col-md-4" style="text-align:right">
						<label>ชื่อสถานะเอกสาร(TH) :</label>
					</div>
					<div class="col-md-6">
						<input type="text" class="form-control" id="EditNameTH"> </input>
					</div>
				</div> @*End col*@
				<br><br><br>
				<div class="col-md-12">
					@*start col*@
					<div class="col-md-4" style="text-align:right">
						<label>ชื่อสถานะเอกสาร(EN) :</label>
					</div>
					<div class="col-md-6">
						<input type="text" class="form-control" id="EditNameEN"> </input>
					</div>
				</div> @*End col*@
				<br><br><br>
				<div class="col-md-12">
					@*start col*@
					<div style="text-align:right;">
						<button onclick="Edit()" class="btn btn-success" >บันทึก</button>
						<a class="btn btn-default" data-dismiss="modal">ยกเลิก</a>
					</div>
				</div>@*End col*@
				<br><br>
			</div>@*End modal body*@
		</div>@*End modal content*@
	</div>@*End modal dialog*@
</div>@*End modal*@
@*End modal edit*@
	</body>
</html>

<script  type="text/javascript">
	var ID = 0;
	$(document).ajaxStart($.blockUI);

	function Get_Data_Add() {
		$('#modal_add_document_status').modal('show');
	}

	function Add() {
		var textdata = "";
		$.getJSON('@Url.Action("Insert_document_status", "Admin")', {
			NameTH: $("#AddTH").val(), NameEN: $("#AddEN").val()
		}, function (data) {
			var i = 1;
			var count = 0;
			$.each(data, function (i, DataDoc) {
				var text = "";
				text = '<tr style="text-align:center"><td>value1</td><td>value2</td><td>value3</td><td><a class="btn btn-warning" onclick="Get_Data_Edit(value4)" ><span class="glyphicon glyphicon-pencil"></span> แก้ไข</a> <a class="btn btn-danger" onclick="Delete(value5)"><span class="glyphicon glyphicon-trash"></span> ลบสถานะ</a></td></tr> ';
				count++;
				text = text.replace("value1", count);
				text = text.replace("value2", DataDoc.NameTH);
				text = text.replace("value3", DataDoc.NameEN);
				text = text.replace("value4", "'" + DataDoc.Id + "','" + DataDoc.NameTH + "','" + DataDoc.NameEN + "'");
				text = text.replace("value5", DataDoc.Id);
				//console.log(text);
				textdata = textdata + text;
			});
		
			$('#table_data').empty();
			$('#table_data').append(textdata);
			});
		setTimeout($.unblockUI, 500); 
		$('#modal_add_document_status').modal('hide');
		$("#AddTH").val("");
		$("#AddEN").val("");
	}

	function Get_Data_Edit(id,NameTH,NameEN) {
		$('#modal_edit_document_status').modal('show');
		$("#EditNameTH").val(NameTH);
		$("#EditNameEN").val(NameEN);
		ID = id;
	}
	
	function Edit() {
		var textdata = "";
		$.getJSON('@Url.Action("Edit_document_status", "Admin")', {
			Id: ID, NameTH: $("#EditNameTH").val(), NameEN: $("#EditNameEN").val()
		}, function (data) {
			var i = 1;
			var count = 0;
			$.each(data, function (i, DataDoc) {
				var text = "";
				text = '<tr style="text-align:center"> </input></td><td>value1</td><td>value2</td><td>value3</td><td><a class="btn btn-warning" onclick="Get_Data_Edit(value4)" ><span class="glyphicon glyphicon-pencil"></span> แก้ไข</a> <a class="btn btn-danger" onclick="Delete(value5)"><span class="glyphicon glyphicon-trash"></span> ลบสถานะ</a></td></tr> ';
				count++;
				text = text.replace("value1", count);
				text = text.replace("value2", DataDoc.NameTH);
				text = text.replace("value3", DataDoc.NameEN);
				text = text.replace("value4", "'" + DataDoc.Id + "','" + DataDoc.NameTH + "','" + DataDoc.NameEN + "'");
				text = text.replace("value5", DataDoc.Id);
				textdata = textdata + text;
			});
			$('#table_data').empty();
			$('#table_data').append(textdata);
			});
		setTimeout($.unblockUI, 500); 
		$('#modal_edit_document_status').modal('hide'); 
		//location.reload();
		}

	function Delete(id) {
		var textdata = "";
		swal({
			title: "ต้องการลบหรือไม่?",
			text: "เมื่อลบแล้วจะไม่สามารถนำข้อมูลกลับมาได้!",
			icon: "warning",
			buttons: true,
			dangerMode: true,
		})
			.then((willDelete) => {
				if (willDelete) {
					$.getJSON('@Url.Action("Delete_document_status", "Admin")', {
					Id:id
					}, function (data) {
						var count = 0;
						$.each(data, function (i, DataDoc) {
							var text = "";
							text = '<tr style="text-align:center"><td>value1</td><td>value2</td><td>value3</td><td><a class="btn btn-warning" onclick="Get_modal_edit(value4)" ><span class="glyphicon glyphicon-pencil"></span> แก้ไข</a> <a class="btn btn-danger" onclick="Delete(value5)"><span class="glyphicon glyphicon-trash"></span> ลบสถานะ</a></td></tr>'
							count++;
							text = text.replace("value1", count);
							text = text.replace("value2", DataDoc.NameTH);
							text = text.replace("value3", DataDoc.NameEN);
							text = text.replace("value4", "'" + DataDoc.Id + "','" + DataDoc.NameTH + "','" + DataDoc.NameEN + "'");
							text = text.replace("value5", DataDoc.Id);
							textdata = textdata + text;
						});
						$('#table_data').empty();
						$('#table_data').append(textdata);
					});
					setTimeout($.unblockUI, 500);
					swal("ลบสำเร็จ", {
						icon: "success",
					});
				} else {
					swal("ยกเลิก");
				}
			});
	}
</script>

